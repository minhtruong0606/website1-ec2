name: Deploy Web2

on:
  push:
    branches: [ main ]
    paths: 
      - 'E-Commerce-1-Website-PHP-MYSQL-main/**'

jobs:
  deploy-web2:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Configure Web2 in Nginx
      uses: appleboy/ssh-action@v0.1.7
      with:
        host: ${{ secrets.EC2_HOST }}
        username: ${{ secrets.EC2_USER }}
        key: ${{ secrets.EC2_SSH_KEY }}
        script: |
          echo "ðŸ”§ Configuring Web2 in Nginx..."
          
          # Táº¡o Nginx config cho web2
          sudo tee /etc/nginx/sites-available/web2 << 'EOF'
          server {
              listen 80;
              server_name _;
              
              root /var/www/html/E-Commerce-1-Website-PHP-MYSQL-main;
              index index.php index.html index.htm;

              location / {
                  try_files $uri $uri/ =404;
              }

              location ~ \.php$ {
                  include snippets/fastcgi-php.conf;
                  fastcgi_pass unix:/var/run/php/php8.1-fpm.sock;
                  fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
                  include fastcgi_params;
              }
          }
          EOF
          
          # KÃ­ch hoáº¡t web2
          sudo ln -sf /etc/nginx/sites-available/web2 /etc/nginx/sites-enabled/
          sudo nginx -t
          sudo systemctl reload nginx
          
          echo "âœ… Web2 configured!"
          echo "ðŸŒ Web2 URL: http://${{ secrets.EC2_HOST }}/E-Commerce-1-Website-PHP-MYSQL-main/"
